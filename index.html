const SPREADSHEET_ID = "1XBO71uDcFsbAWvmb8PVVApsbGcQnHsy_8Wfo9DVDf5w";
const SHEET_NAME = "Sheet1";

function doGet(e) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = ss.getSheetByName(SHEET_NAME);
    
    const params = e.parameter;
    const device = params.device || "Unknown Device";
    const code = params.code || "Unknown Code";
    const browser = params.browser || params.app || "Unknown Browser/App";
    
    const timestamp = new Date();
    const lastRow = sheet.getLastRow();
    let scanCount = 1;
    if (lastRow > 1) {
      const previousCount = sheet.getRange(lastRow, 5).getValue();
      scanCount = Number(previousCount) + 1;
    }
    
    const rowData = [timestamp, device, code, browser, scanCount];
    sheet.appendRow(rowData);
    
    return ContentService.createTextOutput("Data logged successfully").setMimeType(ContentService.MimeType.TEXT);
  } catch (error) {
    Logger.log("Error: " + error.toString());
    return ContentService.createTextOutput("Error: " + error.toString()).setMimeType(ContentService.MimeType.TEXT);
  }
}
